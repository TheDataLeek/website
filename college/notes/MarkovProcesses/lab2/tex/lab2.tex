\documentclass[10pt]{article}

\input{./tex/header.tex}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Beginning of document items - headers, title, toc, etc...
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\pagestyle{fancy}                                                       %  Establishes that the headers will be defined
\fancyhead[LE,LO]{Lab Two}                                  %  Adds header to left
\fancyhead[RE,RO]{Zoe Farmer}                                       %  Adds header to right
\cfoot{\thepage}
\lfoot{APPM4560 - Markov Processes}
\rfoot{Manual Lladser}
\title{APPM 4560 Lab Two}
\author{Zoe Farmer}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Beginning of document items - headers, title, toc, etc...
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

\maketitle

Note, all code/algorithms are in Appendix~\ref{app:code}.

\section{Simulating a Homogeneous Poisson Process (HPP)}

Consider the following algorithm to simulate the arrival times of a HPP with
certain given intensity $\lambda > 0$ on the interval $[0, t]$.

\begin{table}[H]
    \centering
    \begin{tabular}{|l|l|}
        \hline
        Step 1 & Set $i := 0$ and $T(0) := 0$.\\
        Step 2 & Generate $U\sim Unif(0, 1)$.\\
        Step 3 & Set $i := i + 1$ and $T(i) := T(i - 1) - \ln(U) / \lambda$.\\
        Step 4 & If $T(i) > t$, set $N:=(i - 1)$ and stop. Otherwise, GOTO 2.\\
        \hline
    \end{tabular}
    \caption{Algorithm 1}
\end{table}

\subsection{Questions}

\newcommand{\p}{\vspace{0.3cm}}
\newcommand{\image}[1]{\includegraphics[scale=0.5]{#1}}

\begin{easylist}[enumerate]
    @ What do the random variables $T(1), \ldots, T(N)$ generated by Algorithm 1
    represent? Explain.

    \p These are each the points from the Poisson Process. If we imagine our
    algorithm as drawing points on a line of $[0,t]$ then each $T$ value is the
    next point on the line.

    \begin{figure}[H]
        \centering
        \image{./HPP.png}
        \caption{Homogeneous Poisson Process}
    \end{figure}

    @ What's the distribution of the random number $N$? Explain.

    \p We can think of $N$ being the number of points on the real line from
    $(0,t]$, therefore the distribution should be the Poisson distribution with
    parameter $\lambda \cdot t$. This follows as on the unit interval the amount
    of points will have Poisson distribution with parameter $\lambda$, so here
    we're simply scaling by our length, $t$.

    @ What does the random quantity $T(N + 1)$ represent? Explain.

    \p This quantity is the last generated value of our Homogeneous Poisson
    Process which (by definition) falls outside the interval $(0,t]$. To an
    extent, it represents the end of our Homogeneous Poisson Process.

    @ What's the distribution of the random quantity $T(N + 1) - t$? Explain.

    \p This should be the exponential distribution. Our Homogeneous Poisson
    Process has the property of being ``memoryless'', which means that after
    every point the probability of a new point follows the exponential
    distribution. Since the quantity $T(N+1)$ represents the final, non-included
    point, the location of this point should follow the same process that all
    other points follow.

    @ Do the random variables $T(N + 1) - T(N)$ and $T(N + 1) - t$ have the same
    distribution? Explain.

    \p No, these should not follow the same distribution as they are inherently
    different quantities. The former is the difference between the final and the
    pre-final points, and the latter is how far from $t$ the final point falls.

    @ Determine the p.d.f.\ of $T(N + 1)$. Include this calculation.

    \p Since we've already determined that, based on the memoryless property of
    the Homogeneous Poisson Process, the quantity $T(N+1) - t$ should have an
    exponential distribution with parameter $\lambda$, then the quantity
    $T(N+1)$ should simply be the shifted exponential distribution with
    parameter $\lambda$, which is

    \begin{align*}
        T(N+1) \sim \lambda e^{-\lambda (x - t)}
    \end{align*}

    @ Implement Algorithm 1 with $\lambda = 3$ and $t = 4$ and obtain 10K
    simulations of the random vector $(N, T(N), T(N + 1))$. Use the 10K draws to
    obtain the histograms associated with the quantities $N$, $T(N+1) - T(N)$,
    $T(N+1)-t$, and $T(N+1)$, respectively.

    \p See the next three questions for histograms.

    @ Do the generated values of $N$ support your answer to question 2? Comment
    on any expected/unexpected behavior.

    \begin{figure}[H]
        \centering
        \image{./part1_N_hist.png}
        \caption{Histogram of $N$}
    \end{figure}

    Yes they do, however we see some fluctuation, which is most likely a symptom
    of the simulation.

    @ Do the generated values of $T(N+1) - T(N)$ and $T(N+1) - t$ support your
    answer to question 5? Comment.

    \begin{figure}[H]
        \centering
        \image{./part1_TN1_t_hist.png}
        \caption{Histogram of $T(N+1) - t$}
    \end{figure}

    \begin{figure}[H]
        \centering
        \image{./part1_TN1_TN_hist.png}
        \caption{Histogram of $T(N+1) - T(N)$}
    \end{figure}

    As we can see from these above plots, these two quantities do not have the
    same distribution, which supports our previous prediction.

    @ Do the generated values of $T(N+1)$ support question 6? Comment.

    \begin{figure}[H]
        \centering
        \image{./part1_TN1_hist.png}
        \caption{Histogram of $T(N+1)$}
    \end{figure}

    Like we surmised previously, this is simply the shifted exponential
    distribution!
\end{easylist}

\section{Simulating a Non-Homogeneous Poisson Process (NHPP)}

Let $T>0$ be a given real number. We need to simulate a NHPP with intensity
function $\lambda(t)$, for $0 \le t \le T$. This will require

\begin{easylist}[itemize]
    @ Precompute a constant $C > 0$ such that $0 \le \lambda(t) \le C$, $\forall
    t \in [0, T]$.
    @ Simulate the arrival times $T_1, T_2, \ldots$ of HPP with intensity $C$.
    @ Simulate a sequence $U_1, U_2, \ldots$ of i.i.d.\ Uniform$[0,1]$ random
    variables that are independent of the arrival times $T_1, T_2, \ldots$.
\end{easylist}

The claim is that the process

\begin{align*}
    N(t) := \# \cren{
        i: T_i \le t \text{ and } U_i \le \frac{\lambda(T_i)}{C}
    }, \text{ with } N(0) := 0
\end{align*}

is a Poisson Process with intensity function $\lambda(t)$ over the interval
$[0,T]$. In words, $N(t)$ is the number of pairs $(T_i, U_i)$ which satisfy that
$T_i \le t$ and $U_i \le \lambda(T_i) / C$. To simulate a Poisson process with
intensity $\lambda(t)$ for $0 \le t \le T$, it therefore suffices to simulate
$N(t)$. This is easy since we can simulate the arrival times $T_i$ of a HPP with
intensity $C$ (using Algorithm 1) as well as a sequence of Uniform$[0,1]$ random
variables $U_i$.

Let $T=9$ and $\lambda(t) := t^2 - 10 t + 26$.

\begin{figure}[H]
    \centering
    \image{./part2_lambda.png}
    \caption{$\lambda(t) = t^2 - 10 t + 26$}
\end{figure}

\subsection{Questions}

\begin{easylist}[enumerate]
    @ Let $W$ be the random number of arrivals in the time interval $[0, T]$ of
    a NHPP with intensity function $\lambda(t)$. Use the above discussion to
    design a simple algorithm to simulate $W$.

    \p We can simulate the positions, and then simply obtain the number of
    values.

    \begin{table}[H]
        \centering
        \begin{tabular}{|l|l|}
            \hline
            Step 1 & Calculate $C = \max\cren{\lambda(t): t \in [0,T]}$\\
            Step 2 & Set $N_0 = 0$, $t = 0$, $i=0$\\
            Step 3 & Set $u \sim Unif(0, 1)$\\
            Step 4 & Set $t = t - \ln(u) / C$, and $v \sim Unif(0, 1)$\\
            Step 5 & If $v \le \lambda(t) / C$\\
            & \hspace{1cm} Set $N_i = t$, $i = i + 1$\\
            Step 6 & If $N_i > T$\\
            & \hspace{1cm} Set $W = i - 1$, and STOP\\
            & Else\\
            & \hspace{1cm} GOTO Step 3\\
            \hline
        \end{tabular}
        \caption{Algorithm 2 - Simulation of $W$}
    \end{table}

    This looks like the following.

    \begin{figure}
        \centering
        \image{./NHPP.png}
        \caption{Non-Homogeneous Poisson Process}
    \end{figure}

    @ What is the theoretical distribution of $W$? What is $\mathbb{E}(W)$?
    Explain.

    \p Similar to the Homogeneous case, the distribution of $W$ is
    Poisson-distributed with parameter (and expected value)

    \begin{align*}
        \Lambda(W) = \int_W \lambda(t) \, dt
    \end{align*}

    In this case this will be defined as

    \begin{align*}
        \Lambda(W) = 72
    \end{align*}

    We can think about this $\lambda(t)$ as defining the probability over the
    line from $0$ to $T$, therefore the mean intensity can be found using the
    integral.

    @ Implement the algorithm to simulate 10K independent draws of $W$. Does the
    histogram support your answer? Is the sample average of the simulated values
    comparable to the theoretical expected value of $W$? Comment.

    \begin{figure}[H]
        \centering
        \image{./part2_W.png}
        \caption{Histogram of $W$}
    \end{figure}

    This looks exactly like we imagined it would.
\end{easylist}

\newpage
\appendix
\section{Code}\label{app:code}

\inputminted{python}{lab2.py}

\end{document}
